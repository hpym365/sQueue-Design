# sQueue

springboot + vue? or thymeleaf? + druid + mysql?+oracle + 
rabbitmq + redis + swgger2? + 

1、外部系统通过http调用排队叫号系统(his 核医学等外部业务系统)，
2、数据过来之后，通过字典表redis缓存，
先保存redis(使用redis的list集合保存每个科室的队列情况?-通过系统key+医院key+院区key+科室key) 
保存超时或者redis挂掉(超时设置?) 
之后保存数据库.
2、在redis无法使用时候保证系统可以使用数据库正常工作。
3、超时打印日志，使用apache storm进行日志分析。
4、设计表不光考虑到科室 院区 还考虑到医院 名称  为区域化设计做准备；
5、患者标识设计 急诊 军？ vip？不应设置不同字段flag 
不方便扩展，使用一个字段type无法支持多状态 即急诊又vip又军人
Type设置成多几位 第一位 1门诊/2住院 
第二位是否急诊 第三位 VIP 第四位 军人
门诊患者1000 住院2000 急诊 1100 VIP 1010 VIP急诊 0110 军急 1101
6、患者被叫过之后数据应落地 加入到mq消息队列(mq问题时容错?) 
做持久化或数据库已被查询等？
mq解耦 系统在拆分？ 业务处理？  查询处理系统？
7、缓存穿透  缓存失效? 系统启动加载缓存 虽然系统小也考虑进去
8、管理者领导查看院区队列情况？不同权限查看不同级别 医院-院区-科室-...
9、到诊确认？之前预约的插入到队列哪个位置？
如果需要到诊确认就设置两个SortSet队列 一个是明天预约的队列
 一个是明天正常的队列  预约的队列点到诊确认后才进入正常的队列
 //这个需要调研一下 妇婴好像是默认算时间
key为排队号 叫的时候分布式锁 锁定不让别人叫
叫完之后
入口考虑多支持? http 插库 socket连接? webservice?
10、sortset key设计 
需要一个表映射 根据患者Type取号前的标识 设计考虑个性化可是 院区 医院 default
普通排队患者A + 门诊原子INRC +
住院患者B + 住院原子INRC +

11、websocket 推送 每秒 推送

12、数据格式 医院-科室  
161-fsk-cs-queue1
A01 1 A02 2 A03 3
hash A01 id=123456 name=zs sex=nan

13、队列插入权限对应表 配置项
只有拥有对应权限才可以插入对应队列
token = 123456  hospital=161  dep = fsk 可以插入对应队列

14、模块拆分 
业务队列增删查改  后台管理(维护系统配置 字典表 )
统计查询系统数据分析 暂时不开发
 
15、队列状态 
未到诊 等待中 已呼叫 重叫 挂起 
退回查询已呼叫的列表? 队列在最前面
已呼叫直接插入数据库 redis留缓存zset 然后对过期时间进行设置
过期时间到当天晚上12点 就是列表只保留当天叫过的

16、


排队叫号终端支持?
sQueue
